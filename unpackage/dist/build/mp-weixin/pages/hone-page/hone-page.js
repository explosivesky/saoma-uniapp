(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/hone-page/hone-page"],{"1e9f":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=r(e("a34a")),o=e("6a38");function r(t){return t&&t.__esModule?t:{default:t}}function a(t,n,e,i,o,r,a){try{var c=t[r](a),s=c.value}catch(u){return void e(u)}c.done?n(s):Promise.resolve(s).then(i,o)}function c(t){return function(){var n=this,e=arguments;return new Promise((function(i,o){var r=t.apply(n,e);function c(t){a(r,i,o,c,s,"next",t)}function s(t){a(r,i,o,c,s,"throw",t)}c(void 0)}))}}var s=function(){e.e("pages/hone-page/components/goods-details").then(function(){return resolve(e("05a2"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("pages/hone-page/components/shopping-cart").then(function(){return resolve(e("e832"))}.bind(null,e)).catch(e.oe)},d=function(){e.e("pages/skeleton/home").then(function(){return resolve(e("d416"))}.bind(null,e)).catch(e.oe)},h={components:{Cart:u,Details:s,home:d},data:function(){return{scroll_into:"",card:!1,popupitem:!1,goods:[],cate:[],currentIndex:0,heightList:[],shopping_card:[],popup:{},tmplIds:"Z-i5aHP8zP3HNO4MyeoNK9OY9_LfvT6t36Veg3oTbK8",diners:wx.getStorageSync("diners"),iphongCheck:getApp().globalData.iphongCheck,isShow:!0}},methods:{getData:function(){var t=this;return c(i.default.mark((function n(){var e,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e=wx.getStorageSync("uid"),n.next=3,new t.$Requst("/uniapp/getDishes","POST",{uid:e}).req();case 3:o=n.sent,t.goods=o.data.data.response.res_data,t.cate=o.data.data.response.res_cate;case 6:case"end":return n.stop()}}),n)})))()},scroLl:function(t){var n=t.detail.scrollTop;n>=this.scrollTop?n>=this.heightList[this.currentIndex]&&(this.currentIndex+=1):n<this.heightList[this.currentIndex-1]&&(this.currentIndex-=1),this.scrollTop=n},plus:function(t,n,e,i){var o=i.quantity,r=i.image,a=i.name,c=i.signprice,s=i.unit,u=i.id,d=o+1;this.$set(this.goods[t].query[n],"quantity",d);var h={i:t,image:r,name:a,signprice:c,unit:s,id:u,cid:e,goods_index:n,quantity:d,total_price:d*c};this.shopping_cart(h)},decr:function(t,n,e,i){var o=i.quantity,r=i.image,a=i.name,c=i.signprice,s=i.unit,u=i.id,d=o-1;this.$set(this.goods[t].query[n],"quantity",d);var h={i:t,image:r,name:a,signprice:c,unit:s,id:u,cid:e,goods_index:n,quantity:d,total_price:d*c};this.shopping_cart(h)},shopping_cart:function(t){if(this.shopping_card.length){var n=this.shopping_card.findIndex((function(n){return n.id==t.id}));-1!=n?(this.$set(this.shopping_card[n],"quantity",t.quantity),this.$set(this.shopping_card[n],"total_price",t.total_price)):this.shopping_card.unshift(t)}else this.shopping_card.unshift(t);this.left_quantity()},left_quantity:function(){var t=this,n={},e=[];this.shopping_card.forEach((function(t,i){n[t.cid]?e.forEach((function(n){n.cid==t.cid&&(n.value+=t.quantity)})):(n[t.cid]=!0,e.push({cid:t.cid,value:t.quantity}))})),e.forEach((function(n){var e=t.cate.findIndex((function(t){return n.cid==t.cid}));t.$set(t.cate[e],"sele_quantity",n.value)}))},handle:function(t,n){var e=this;this.currentIndex=t,this.scroll_into=n,setTimeout((function(){e.scroll_into=""}),150)},bottom:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.card=t},cartCtrl:function(t,n,e){var i=e.signprice,o=e.i,r=e.goods_index;e.cid;this.$set(this.shopping_card[t],"quantity",n),this.$set(this.shopping_card[t],"total_price",n*i),this.$set(this.goods[o].query[r],"quantity",n),this.left_quantity()},empty:function(){this.shopping_card=[],this.cate.forEach((function(t){t.sele_quantity=0})),this.goods.forEach((function(t){t.query.forEach((function(t){t.quantity=0}))}))},detail:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.popupitem=t,0!=t&&(n.goods_index=e,n.i=o,n.cid=i,this.popup=n)},subscription:function(){var t=this,n=this.shopping_card.filter((function(t){return 0!=t.total_price}));0!=n.length?wx.requestSubscribeMessage({tmplIds:[this.tmplIds],success:function(e){t.placeAnOrder(n)},fail:function(t){console.log(t)}}):wx.showToast({title:"请选择菜品",icon:"error",duration:2e3})},placeAnOrder:function(t){var n=this;return c(i.default.mark((function e(){var r,a,c,s,u,d,h;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return wx.showLoading({title:"提交中，请稍后",mask:!0}),r=0,t.forEach((function(t){r+=t.total_price})),a=wx.getStorageSync("openid"),c=wx.getStorageSync("uid"),s=wx.getStorageSync("table_num"),u=wx.getStorageSync("diners"),d={table_number:s,uid:c,openId:a,number_of_diners:u,order_time:n.$moment().utcOffset(8).format("YY-MM-DD HH:mm:ss"),settle_amount:r,order_num:(0,o.orderCode)(),transaction_status:"unsettle",order_receiving:"miss_order",menu:[{backup:"备用字段",goods_list:t}]},e.next=10,new n.$Requst("/uniapp/submitDishes","POST",d).req();case 10:e.sent,h=n.$goeasy.pubsub,h.publish({channel:"my_channel",message:wx.getStorageSync("uid"),onSuccess:function(){console.log("消息发布成功。")},onFailed:function(t){console.log("消息发送失败，错误编码："+t.code+" 错误信息："+t.content)}}),wx.redirectTo({url:"../order-detail/order-detail?val=1"});case 14:case"end":return e.stop()}}),e)})))()},goToMyOrder:function(){wx.navigateTo({url:"../my-order/my-order"})}},onLoad:function(){this.getData()},mounted:function(){var n=this;setTimeout((function(){var e=0,i=t.createSelectorQuery();i.selectAll(".rig-height").boundingClientRect(),i.exec((function(t){t[0].forEach((function(t){e+=t.height,n.heightList.push(e)}))})),n.isShow=!1}),100)},computed:{countTotal:function(){var t=0;return this.shopping_card.forEach((function(n){t+=n.quantity})),t}}};n.default=h}).call(this,e("543d")["default"])},"25dd":function(t,n,e){},"67d3":function(t,n,e){"use strict";var i=e("25dd"),o=e.n(i);o.a},"72b6":function(t,n,e){"use strict";e.r(n);var i=e("1e9f"),o=e.n(i);for(var r in i)"default"!==r&&function(t){e.d(n,t,(function(){return i[t]}))}(r);n["default"]=o.a},9593:function(t,n,e){"use strict";var i;e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return r})),e.d(n,"a",(function(){return i}));var o=function(){var t=this,n=t.$createElement;t._self._c},r=[]},ce29:function(t,n,e){"use strict";(function(t){e("02e3");i(e("66fd"));var n=i(e("fd94"));function i(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},fd94:function(t,n,e){"use strict";e.r(n);var i=e("9593"),o=e("72b6");for(var r in o)"default"!==r&&function(t){e.d(n,t,(function(){return o[t]}))}(r);e("67d3");var a,c=e("f0c5"),s=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,"0a96be5d",null,!1,i["a"],a);n["default"]=s.exports}},[["ce29","common/runtime","common/vendor"]]]);